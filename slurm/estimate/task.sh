#!/bin/bash
set -eo pipefail

CONDA_ENV_NAME=$1
EXECUTABLE_PATH=$2
DB_DIR=$3

if [ -z "$4" ] || [ -z "$5" ]; then
  TASK_INDEX=$SLURM_PROCID
  TASK_COUNT=$SLURM_NTASKS
else
  JOB_INDEX=$4
  JOB_COUNT=$5
  TASK_INDEX=$(( JOB_INDEX * SLURM_NTASKS + SLURM_PROCID ))
  TASK_COUNT=$(( JOB_COUNT * SLURM_NTASKS ))
fi

./task_item.sh "$CONDA_ENV_NAME" "$EXECUTABLE_PATH" "$DB_DIR" "$TASK_INDEX" "$TASK_COUNT"